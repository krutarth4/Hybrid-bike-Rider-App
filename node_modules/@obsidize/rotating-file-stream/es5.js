(()=>{"use strict";var t={d:(e,i)=>{for(var r in i)t.o(i,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{CapacitorFileEntryApi:()=>a,CordovaFileEntryApi:()=>o,RotatingFileStream:()=>s});const i=require("tslib"),r="ascii";class a{constructor(t,e,i){this.capacitorFilesystem=t,this.directory=e,this.filePath=i,this.mModifiedTime=0,this.mSize=0,this.mUri=null}static createCacheRotationFiles(t,e,i){return a.createRotationFiles(t,"CACHE",e,i)}static createRotationFiles(t,e,i,r){return r.map((r=>new a(t,e,`${i}/${r}`)))}getFileName(){return this.filePath}getDirectoryName(){return this.directory}toURL(){return this.mUri}getSize(){return this.mSize}getLastModificationTime(){return this.mModifiedTime}read(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{data:t}=yield this.capacitorFilesystem.readFile({directory:this.directory,path:this.filePath,encoding:r});return(new TextEncoder).encode(t).buffer}))}refresh(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{mtime:t,size:e,uri:i}=yield this.capacitorFilesystem.stat({directory:this.directory,path:this.filePath}).catch((()=>({mtime:0,size:0,uri:""})));this.mModifiedTime=t,this.mSize=e,this.mUri=i}))}write(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){yield this.refresh();const i=(new TextDecoder).decode(t);e||this.mSize<=0?yield this.overwriteFileData(i):yield this.appendFileData(i)}))}appendFileData(t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){yield this.capacitorFilesystem.appendFile({directory:this.directory,path:this.filePath,encoding:r,data:t})}))}overwriteFileData(t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{uri:e}=yield this.capacitorFilesystem.writeFile({directory:this.directory,path:this.filePath,encoding:r,recursive:!0,data:t});this.mUri=e}))}}class o{constructor(t,e,i,r){this.cordovaFile=t,this.baseCordovaDirectoryNameDelegate=e,this.directoryName=i,this.fileName=r,this.targetBaseDirectory=null,this.targetDirectory=null,this.targetFile=null,this.targetFileMetadata=null}static createCacheRotationFiles(t,e,i){return o.createRotationFiles(t,(()=>t.cacheDirectory),e,i)}static createRotationFiles(t,e,i,r){return r.map((r=>new o(t,e,i,r)))}get baseCordovaDirectoryName(){return this.baseCordovaDirectoryNameDelegate()}getFileName(){return this.fileName}getDirectoryName(){return this.directoryName}toURL(){return this.targetFile?this.targetFile.toURL():""}getSize(){return this.targetFileMetadata?this.targetFileMetadata.size:0}getLastModificationTime(){return this.targetFileMetadata?new Date(this.targetFileMetadata.modificationTime).getTime():0}write(t,e){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.targetDirectory||(yield this.refresh()),yield this.cordovaFile.writeFile(this.targetDirectory.toURL(),this.fileName,t,{append:!e,replace:e})}))}read(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){return this.targetDirectory||(yield this.refresh()),this.cordovaFile.readAsArrayBuffer(this.targetDirectory.toURL(),this.fileName)}))}refresh(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){this.targetBaseDirectory=yield this.cordovaFile.resolveDirectoryUrl(this.baseCordovaDirectoryName),this.targetDirectory=yield this.cordovaFile.getDirectory(this.targetBaseDirectory,this.directoryName,{create:!0}),this.targetFile=yield this.cordovaFile.getFile(this.targetDirectory,this.fileName,{create:!0}),this.targetFileMetadata=yield new Promise(((t,e)=>this.targetFile.getMetadata(t,e)))}))}}class s{constructor(t){this.options=t}write(t){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.loadTargetEntry(),i=this.isEntryFull(e);yield e.write(t,i)}))}refreshAllEntries(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const{files:t}=this.options;for(const e of t)yield e.refresh();return t}))}isEntryFull(t){return t.getSize()>=this.options.maxFileSize}loadTargetEntry(){return(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.refreshAllEntries();let e=t[0];for(let i=1;i<t.length;i++)e=this.chooseOptimalTarget(e,t[i]);return e}))}chooseOptimalTarget(t,e){return this.isEntryFull(t)?this.isEntryFull(e)?t.getLastModificationTime()>e.getLastModificationTime()?e:t:e:t}}module.exports=e})();